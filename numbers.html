<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Magic Numbers</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }

    .magic-number {
      position: absolute;
      font-size: 16px;
      color: #000;
      user-select: none;
    }
  </style>
</head>
<body>

<script>
  let visibleMagicNumbers = [];
  let touchDetected = false;

  function createMagicNumbers(gridSize) {
    const body = document.body;
    const screenWidth = window.innerWidth;
    const screenHeight = window.innerHeight;

    const cellWidth = screenWidth / gridSize;
    const cellHeight = screenHeight / gridSize;

    const magicNumbers = [];

    for (let i = 0; i < gridSize; i++) {
      for (let j = 0; j < gridSize; j++) {
        const magicNumber = document.createElement('div');
        magicNumber.className = 'magic-number';
        const randomNumber = Math.floor(Math.random() * 90 + 10); // Generating two-digit numbers
        magicNumber.textContent = randomNumber;

        const positionX = i * cellWidth + Math.random() * (cellWidth - 20);
        const positionY = j * cellHeight + Math.random() * (cellHeight - 20);

        magicNumber.style.left = positionX + 'px';
        magicNumber.style.top = positionY + 'px';

        // Randomly adjust the font size
        const randomSize = Math.floor(Math.random() * 16) + 10; // Adjust the range as needed
        magicNumber.style.fontSize = randomSize + 'px';

        magicNumber.addEventListener('touchstart', handleTouchStart, false);

        magicNumbers.push(magicNumber);
        body.appendChild(magicNumber);
      }
    }

    return magicNumbers;
  }

  function handleTouchStart() {
    touchDetected = true;
    setTimeout(() => {
      touchDetected = false;
    }, 4000);
  }

  function handleZoomEnd() {
    if (!touchDetected && visibleMagicNumbers.length > 0) {
      const centerX = window.innerWidth / 2;
      const centerY = window.innerHeight / 2;

      let closestDistance = Infinity;
      let closestNumber = null;

      for (const magicNumber of visibleMagicNumbers) {
        const rect = magicNumber.getBoundingClientRect();
        const numberX = rect.left + rect.width / 2;
        const numberY = rect.top + rect.height / 2;

        const distance = Math.sqrt((numberX - centerX) ** 2 + (numberY - centerY) ** 2);

        if (distance < closestDistance) {
          closestDistance = distance;
          closestNumber = magicNumber;
        }
      }

      if (closestNumber) {
        closestNumber.textContent = '27';
      }
    }
  }

  // Detect visible numbers on the screen
  function updateVisibleMagicNumbers() {
    visibleMagicNumbers = Array.from(document.querySelectorAll('.magic-number'))
      .filter((magicNumber) => isElementVisible(magicNumber));
  }

  // Check if an element is visible on the screen
  function isElementVisible(element) {
    const rect = element.getBoundingClientRect();
    return (
      rect.top >= 0 &&
      rect.left >= 0 &&
      rect.bottom <= window.innerHeight &&
      rect.right <= window.innerWidth
    );
  }

  const magicNumbers = createMagicNumbers(8); // You can change this number to adjust the grid size

  document.addEventListener('touchstart', handleTouchStart, false);

  document.addEventListener('gestureend', handleZoomEnd, false);

  // Update visible numbers after the zoom ends
  window.addEventListener('resize', () => {
    updateVisibleMagicNumbers();
  });

</script>

</body>
</html>
